<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<title>Omni motion</title>
<link rel="stylesheet" href="./../../asciidoctor.css">
</head>
<body class="article">
<div id="header">
<h1>Omni motion</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="_coordinate_system">Coordinate system</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="../images/omni_motion_vectors.png" alt="omni motion vectors">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_units">Units</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>wheelLinearVelocity - m/s</p>
</li>
<li>
<p>robotSpeed - m/s</p>
</li>
<li>
<p>robotSpeedX - m/s</p>
</li>
<li>
<p>robotSpeedY - m/s</p>
</li>
<li>
<p>robotDirectionAngle - rad</p>
</li>
<li>
<p>wheelAngle - rad</p>
</li>
<li>
<p>wheelDistanceFromCenter - m</p>
</li>
<li>
<p>robotAngularVelocity - rad/s</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wheel_speed_calculation">Wheel speed calculation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_in_meters_per_second">In meters per second</h3>
<div class="listingblock">
<div class="content">
<pre>wheelLinearVelocity = robotSpeed * cos(robotDirectionAngle - wheelAngle) + wheelDistanceFromCenter * robotAngularVelocity</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_in_mainboard_units">In mainboard units</h3>
<div class="paragraph">
<p>Mainboard units can be used directly without any conversion to meters per second.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>wheelVelocityInMainboardUnits = robotSpeedInMainboardUnits * cos(robotDirectionAngle - wheelAngle) + robotAngularVelocityInMainboardUnits</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_forward_and_sideways_robot_speeds">Using forward and sideways robot speeds</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>robotSpeed</code> and <code>robotDirectionAngle</code> can be calculated using sideways
(x-axis direction) and forward (y-axis direction) speeds:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>robotSpeed = sqrt(robotSpeedX * robotSpeedX + robotSpeedY * robotSpeedY)

robotDirectionAngle = atan2(robotSpeedY, robotSpeedX)</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wheel_linear_velocity_in_mainboard_units">Wheel linear velocity in mainboard units</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>wheelAngularSpeedInMainboardUnits = (wheelAngularVelocity / (2 * PI())) * encoderCountsPerWheelRevolution * pidControlPeriod</pre>
</div>
</div>
<div class="paragraph">
<p>where</p>
</div>
<div class="listingblock">
<div class="content">
<pre>wheelAngularVelocity = wheelLinearVelocity / wheelRadius

encoderCountsPerWheelRevolution = gearboxReductionRatio * encoderEdgesPerMotorRevolution

pidControlPeriod = 1 / pidControlFrequency</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Simplified</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>wheelAngularSpeedInMainboardUnits = wheelLinearVelocity * gearboxReductionRatio * encoderEdgesPerMotorRevolution / (2 * PI * wheelRadius * pidControlFrequency)</pre>
</div>
</div>
<div class="paragraph">
<p>OR</p>
</div>
<div class="listingblock">
<div class="content">
<pre>wheelAngularSpeedInMainboardUnits = wheelLinearVelocity * wheelSpeedToMainboardUnits</pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>wheelSpeedToMainboardUnits</code> is constant and can be calculated once in advance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>wheelSpeedToMainboardUnits = gearboxReductionRatio * encoderEdgesPerMotorRevolution / (2 * PI * wheelRadius * pidControlFrequency)</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pololu 37D 19:1 motor</p>
</li>
<li>
<p>100 Hz PID calculation frequency</p>
</li>
<li>
<p>70mm diameter wheels</p>
</li>
<li>
<p>gearboxReductionRatio = 18.75</p>
</li>
<li>
<p>encoderEdgesPerMotorRevolution = 64</p>
</li>
<li>
<p>wheelRadius = 0.035 [m]</p>
</li>
<li>
<p>pidControlFrequency = 100 [Hz]</p>
</li>
<li>
<p>wheelLinearVelocity = 2 [m/s]</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>wheelSpeedToMainboardUnits = 18.75 * 64 / (2 * PI * 0.035 * 100) ≈ 54.5674

wheelAngularSpeedInMainboardUnits = 2 * 54.5674 ≈ 109.1348</pre>
</div>
</div>
</div>
</div>
</div>
</body>
</html>